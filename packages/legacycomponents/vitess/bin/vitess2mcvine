#!/usr/bin/env python


import numpy as np, mcni

# Important: align should be on
vitess_neutron = np.dtype([
    ('TotalID', [
        ('IDGrp', '2c'),
        ('IDNo', 'uint64'),
        ]),
    ('Debug', 'c'),
    ('Color', 'i2'),
    ('Time', 'f8'),
    ('Wavelength', 'f8'),
    ('Probability', 'f8'),
    ('Position', '3f8'),
    ('Vector', '3f8'),
    ('Spin', '3f8'),
    ], align=True)
assert vitess_neutron.itemsize == 120



def convert(ifile, ofile):
    # get vitess neutrons
    vns = vitessneutrons = np.memmap(ifile, dtype=vitess_neutron)
    # convert
    from vitess.convert_neutrons import vitess2mcvine_npyarr
    arr = vitess2mcvine_npyarr(vns)
    # save
    from mcni.neutron_storage.idf_usenumpy import write
    write(arr, ofile)
    return



def main():
    import sys
    ifile, ofile = sys.argv[1:]
    convert(ifile, ofile)
    return


if __name__ == '__main__': main()

